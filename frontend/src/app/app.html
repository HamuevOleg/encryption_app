<div class="app-container">
  <header class="app-header">
    <div class="brand">
      <h1>{{ title() }}</h1>
      <p>Try AES, RSA and ECC in one clean interface.</p>
    </div>
    <button class="secondary" (click)="openKeyModal()">What is a key?</button>
  </header>

  <main class="app-main">
    <section class="sidebar">
      <section class="algorithms">
        <h3>Choose an algorithm</h3>
        <div class="cards">
          @for (alg of algorithms(); track alg.id) {
            <div
              class="card"
              [class.active]="alg.id === selectedMethod()"
              (click)="setMethod(alg.id)"
            >
              <div class="card-header">
                <h3>{{ alg.name }}</h3>
                <span class="badge">{{ alg.id }}</span>
              </div>
              <p class="short">{{ alg.short }}</p>
              <div class="card-actions">
                <button
                  class="ghost"
                  (click)="openAlgorithmModal(alg); $event.stopPropagation()"
                >
                  Learn more
                </button>
              </div>
            </div>
          }
        </div>
      </section>

      <div class="info-card">
        <h4>Quick Info</h4>
        <ul class="info-list">
          <li><strong>AES</strong> – fast symmetric encryption</li>
          <li><strong>RSA</strong> – classic public-key cryptography</li>
          <li><strong>ECC</strong> – modern elliptic-curve cryptography</li>
        </ul>
      </div>
    </section>

    <section class="panel">
      <div class="panel-header">
        <div *ngIf="selectedAlgorithm() as alg">
          <h2>{{ alg.name }} - {{ selectedMethod() === 'AES' ? 'Symmetric' : 'Asymmetric' }} Encryption</h2>
          <p class="panel-subtitle">{{ alg.short }}</p>
        </div>
      </div>

      <!-- Keys Section First -->
      <div class="keys-section-top">
        <div class="section-title">
          <h3>Keys</h3>
          <span class="hint">Generate or paste your keys here</span>
        </div>

        <div *ngIf="selectedMethod() === 'AES'" class="key-row-horizontal">
          <div class="key-input-wrapper">
            <label>
              AES Key (base64)
              <span class="key-example">Example: {{ aesKeyExample }}</span>
            </label>
            <div class="input-with-button">
              <textarea
                [ngModel]="aesKey()"
                (ngModelChange)="aesKey.set($event)"
                placeholder="Paste AES key or generate new one"
                rows="2"
              ></textarea>
              <button class="generate-btn" (click)="onGenerateAesKey()">Generate</button>
            </div>
          </div>
        </div>

        <div *ngIf="selectedMethod() === 'RSA'" class="key-row-grid">
          <div class="key-input-wrapper">
            <label>
              RSA Public Key (PEM)
              <span class="key-example">Used for encryption</span>
            </label>
            <textarea
              [ngModel]="rsaPublicKey()"
              (ngModelChange)="rsaPublicKey.set($event)"
              placeholder="-----BEGIN PUBLIC KEY-----"
              rows="3"
            ></textarea>
          </div>
          <div class="key-input-wrapper">
            <label>
              RSA Private Key (PEM)
              <span class="key-example">Used for decryption</span>
            </label>
            <textarea
              [ngModel]="rsaPrivateKey()"
              (ngModelChange)="rsaPrivateKey.set($event)"
              placeholder="-----BEGIN PRIVATE KEY-----"
              rows="3"
            ></textarea>
          </div>
          <button class="generate-btn-full" (click)="onGenerateRsaKeys()">Generate RSA Keys</button>
        </div>

        <div *ngIf="selectedMethod() === 'ECC'" class="key-row-grid">
          <div class="key-input-wrapper">
            <label>
              ECC Public Key (hex)
              <span class="key-example">Compressed format</span>
            </label>
            <textarea
              [ngModel]="eccPublicKey()"
              (ngModelChange)="eccPublicKey.set($event)"
              placeholder="02a1b2c3d4..."
              rows="3"
            ></textarea>
          </div>
          <div class="key-input-wrapper">
            <label>
              ECC Private Key (hex)
              <span class="key-example">Keep secret!</span>
            </label>
            <textarea
              [ngModel]="eccPrivateKey()"
              (ngModelChange)="eccPrivateKey.set($event)"
              placeholder="1234567890abcdef..."
              rows="3"
            ></textarea>
          </div>
          <button class="generate-btn-full" (click)="onGenerateEccKeys()">Generate ECC Keys</button>
        </div>
      </div>

      <!-- Input/Output Section -->
      <div class="io-section">
        <div class="section-title">
          <h3>Text Input & Output</h3>
          <span class="hint">Enter text to encrypt or see decryption results</span>
        </div>

        <div class="io-grid">
          <div class="io-column input-column">
            <label>
              <span class="label-icon"></span>
              Input Text
            </label>
            <textarea
              [ngModel]="plaintext()"
              (ngModelChange)="plaintext.set($event)"
              placeholder="Type your message here..."
              rows="6"
            ></textarea>
          </div>

          <div class="io-column output-column">
            <label>
              <span class="label-icon"></span>
              Encrypted Output
            </label>
            <textarea
              [ngModel]="encryptedText()"
              (ngModelChange)="encryptedText.set($event)"
              placeholder="Encrypted text will appear here..."
              rows="6"
              readonly
            ></textarea>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="primary" (click)="onEncrypt()" [disabled]="isLoading()">
          Encrypt
        </button>
        <button class="outline" (click)="onDecrypt()" [disabled]="isLoading()">
          Decrypt
        </button>
      </div>

      <div class="messages">
        <div class="error" *ngIf="errorMessage()">{{ errorMessage() }}</div>
        <div class="info" *ngIf="infoMessage()">{{ infoMessage() }}</div>
        <div class="meta" *ngIf="lastExecutionTimeMs() !== null && lastOperation() !== null">
          <span>
            Client sent a REST {{ lastOperation() }} request to the Elysia.js backend and got a
            response in {{ lastExecutionTimeMs() }} ms.
          </span>
        </div>
      </div>
    </section>
  </main>

  <!-- Modals remain the same -->
  <div class="modal-backdrop" *ngIf="showAlgorithmModal()">
    <div class="modal">
      <header>
        <h2>{{ activeAlgorithmInfo()?.name }}</h2>
        <button class="icon" (click)="closeAlgorithmModal()">×</button>
      </header>
      <section>
        <p>{{ activeAlgorithmInfo()?.description }}</p>
        <h3>How it works</h3>
        <p>{{ activeAlgorithmInfo()?.howItWorks }}</p>

        <div class="modal-columns">
          <div>
            <h4>Pros</h4>
            <ul>
              <li *ngFor="let p of activeAlgorithmInfo()?.pros">{{ p }}</li>
            </ul>
          </div>
          <div>
            <h4>Cons</h4>
            <ul>
              <li *ngFor="let c of activeAlgorithmInfo()?.cons">{{ c }}</li>
            </ul>
          </div>
        </div>

        <h4>Common uses</h4>
        <ul class="tags">
          <li *ngFor="let u of activeAlgorithmInfo()?.uses">{{ u }}</li>
        </ul>
      </section>
      <footer>
        <button class="primary" (click)="closeAlgorithmModal()">Got it</button>
      </footer>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showKeyModal()">
    <div class="modal">
      <header>
        <h2>{{ keyExplanation.title }}</h2>
        <button class="icon" (click)="closeKeyModal()">×</button>
      </header>
      <section>
        <p *ngFor="let p of keyExplanation.paragraphs">{{ p }}</p>
      </section>
      <footer>
        <button class="primary" (click)="closeKeyModal()">Close</button>
      </footer>
    </div>
  </div>
</div>
